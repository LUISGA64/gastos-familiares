{% extends 'gastos/base.html' %}

{% block title %}Categorías - Gastos Familiares{% endblock %}

{% block extra_css %}
<style>
    .categoria-card {
        border: none;
        border-radius: 16px;
        overflow: hidden;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .categoria-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }

    .categoria-header {
        background: linear-gradient(135deg, #3498db 0%, #2c3e50 100%);
        padding: 24px;
        color: white;
        position: relative;
        overflow: hidden;
    }

    .categoria-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -10%;
        width: 200px;
        height: 200px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
    }

    .categoria-icon {
        width: 60px;
        height: 60px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        margin-bottom: 12px;
    }

    .subcategoria-item {
        border: none;
        border-left: 4px solid transparent;
        transition: all 0.2s ease;
        padding: 16px;
        margin-bottom: 8px;
        border-radius: 0 8px 8px 0;
        background: #f8f9fa;
    }

    .subcategoria-item:hover {
        background: white;
        border-left-color: #3498db;
        transform: translateX(4px);
        box-shadow: 0 2px 8px rgba(52, 152, 219, 0.2);
    }

    .subcategoria-item.fijo {
        border-left-color: #e74c3c;
    }

    .subcategoria-item.variable {
        border-left-color: #f39c12;
    }

    .badge-modern {
        padding: 6px 14px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.75rem;
        letter-spacing: 0.5px;
    }

    .badge-fijo-modern {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        color: white;
        box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
    }

    .badge-variable-modern {
        background: linear-gradient(135deg, #f39c12, #d68910);
        color: white;
        box-shadow: 0 2px 8px rgba(243, 156, 18, 0.3);
    }

    .stats-row {
        display: flex;
        gap: 16px;
        margin-top: 16px;
    }

    .stat-box {
        flex: 1;
        background: rgba(255, 255, 255, 0.2);
        padding: 12px;
        border-radius: 8px;
        text-align: center;
    }

    .stat-box .number {
        font-size: 24px;
        font-weight: bold;
        display: block;
    }

    .stat-box .label {
        font-size: 12px;
        opacity: 0.9;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        background: linear-gradient(135deg, #ecf0f1 0%, #bdc3c7 100%);
        border-radius: 16px;
    }

    .empty-state i {
        font-size: 80px;
        color: #95a5a6;
        margin-bottom: 20px;
    }

    .action-buttons {
        display: flex;
        gap: 8px;
    }

    .btn-icon {
        width: 36px;
        height: 36px;
        padding: 0;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
    }
</style>
{% endblock %}

{% block content %}
<div class="row mb-4 fade-in">
    <div class="col-md-8">
        <h1 class="display-6 fw-bold">
            <i class="bi bi-tags-fill text-primary"></i> Categorías de Gastos
        </h1>
        <p class="text-muted fs-5">Organiza tus gastos en categorías y subcategorías</p>
    </div>
    <div class="col-md-4 text-end">
        <div class="d-flex gap-2 justify-content-end">
            <a href="{% url 'crear_categoria' %}" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i> Nueva Categoría
            </a>
            <a href="{% url 'crear_subcategoria' %}" class="btn btn-success">
                <i class="bi bi-plus-circle"></i> Nueva Subcategoría
            </a>
        </div>
    </div>
</div>

{% if categorias %}
<div class="row">
    {% for categoria in categorias %}
    <div class="col-lg-6 mb-4">
        <div class="card categoria-card">
            <div class="categoria-header">
                <div class="categoria-icon">
                    <i class="bi bi-folder-fill"></i>
                </div>
                <h4 class="mb-2">{{ categoria.nombre }}</h4>
                {% if categoria.descripcion %}
                <p class="mb-0 opacity-75">{{ categoria.descripcion }}</p>
                {% endif %}

                <div class="stats-row">
                    <div class="stat-box">
                        <span class="number">{{ categoria.total_subcategorias }}</span>
                        <span class="label">Subcategorías</span>
                    </div>
                    <div class="stat-box">
                        <span class="number">{{ categoria.subcategorias.all|length }}</span>
                        <span class="label">Activas</span>
                    </div>
                </div>

                <div class="action-buttons position-absolute top-0 end-0 m-3">
                    <a href="{% url 'editar_categoria' categoria.pk %}" class="btn btn-light btn-icon" title="Editar">
                        <i class="bi bi-pencil-fill"></i>
                    </a>
                    {% if not categoria.activo %}
                    <span class="badge bg-secondary">Inactiva</span>
                    {% endif %}
                </div>
            </div>

            <div class="card-body">
                {% if categoria.subcategorias.all %}
                    <!-- Subcategorías Fijas -->
                    {% with fijas=categoria.subcategorias.all|dictsort:"tipo" %}
                    {% if fijas|length > 0 %}
                    <h6 class="text-danger mb-3">
                        <i class="bi bi-pin-angle-fill"></i> Gastos Fijos
                    </h6>
                    {% for sub in categoria.subcategorias.all %}
                        {% if sub.tipo == 'FIJO' and sub.activo %}
                        <div class="subcategoria-item fijo">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <strong><i class="bi bi-arrow-return-right me-2"></i>{{ sub.nombre }}</strong>
                                    {% if sub.monto_estimado %}
                                    <br><small class="text-muted">Estimado: ${{ sub.monto_estimado|floatformat:0 }}</small>
                                    {% endif %}
                                </div>
                                <span class="badge badge-fijo-modern">FIJO</span>
                            </div>
                        </div>
                        {% endif %}
                    {% endfor %}
                    {% endif %}
                    {% endwith %}

                    <!-- Subcategorías Variables -->
                    <h6 class="text-warning mb-3 mt-4">
                        <i class="bi bi-shuffle"></i> Gastos Variables
                    </h6>
                    {% for sub in categoria.subcategorias.all %}
                        {% if sub.tipo == 'VARIABLE' and sub.activo %}
                        <div class="subcategoria-item variable">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <strong><i class="bi bi-arrow-return-right me-2"></i>{{ sub.nombre }}</strong>
                                    {% if sub.monto_estimado %}
                                    <br><small class="text-muted">Estimado: ${{ sub.monto_estimado|floatformat:0 }}</small>
                                    {% endif %}
                                </div>
                                <span class="badge badge-variable-modern">VARIABLE</span>
                            </div>
                        </div>
                        {% endif %}
                    {% endfor %}

                    <div class="text-center mt-4">
                        <a href="{% url 'lista_subcategorias' %}" class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-eye"></i> Ver todas las subcategorías
                        </a>
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="bi bi-inbox"></i>
                        <h5>Sin subcategorías</h5>
                        <p class="text-muted">Esta categoría no tiene subcategorías aún.</p>
                        <a href="{% url 'crear_subcategoria' %}" class="btn btn-primary">
                            <i class="bi bi-plus-circle"></i> Agregar Subcategoría
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<!-- Estado vacío - sin categorías -->
<div class="empty-state">
    <i class="bi bi-inbox"></i>
    <h2>No hay categorías registradas</h2>
    <p class="text-muted mb-4">Comienza creando tu primera categoría para organizar tus gastos</p>
    <a href="{% url 'crear_categoria' %}" class="btn btn-primary btn-lg">
        <i class="bi bi-plus-circle"></i> Crear Primera Categoría
    </a>
</div>
{% endif %}

<!-- Tarjeta informativa -->
<div class="row mt-5">
    <div class="col-lg-12">
        <div class="card" style="background: linear-gradient(135deg, rgba(52, 152, 219, 0.1) 0%, rgba(44, 62, 80, 0.1) 100%); border: none;">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h5><i class="bi bi-lightbulb-fill text-warning"></i> Tip: Organiza mejor tus gastos</h5>
                        <p class="mb-0 text-muted">
                            Las <strong>categorías principales</strong> son agrupaciones generales como "Servicios Públicos", "Vivienda", "Alimentación".
                            Las <strong>subcategorías</strong> son gastos específicos dentro de cada categoría.
                            Usa gastos <strong class="text-danger">Fijos</strong> para pagos recurrentes
                            y <strong class="text-warning">Variables</strong> para gastos ocasionales.
                        </p>
                        <div class="mt-3">
                            <span class="badge bg-light text-dark me-2">
                                <i class="bi bi-check-circle-fill text-success"></i> Ejemplo: Servicios → Internet (Fijo $70.000)
                            </span>
                            <span class="badge bg-light text-dark">
                                <i class="bi bi-check-circle-fill text-success"></i> Acueducto (Variable)
                            </span>
                        </div>
                    </div>
                    <div class="col-md-4 text-center">
                        <i class="bi bi-diagram-3-fill" style="font-size: 80px; color: #3498db; opacity: 0.2;"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

